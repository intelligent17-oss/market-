<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Intelligent Marketplace</title>
  <style>
    body { font-family: Arial, sans-serif; background:#f5f5f5; margin:0; padding:20px; }
    .container { max-width:700px; margin:auto; background:#fff; padding:20px; border-radius:10px; box-shadow:0 6px 20px rgba(0,0,0,0.05); }
    h2 { text-align:center; margin-top:0; }
    .status { padding:10px; margin:10px 0; border-radius:6px; display:none; font-weight:600; }
    .loading { background:#fff3cd; color:#856404; }
    .success { background:#d4edda; color:#155724; }
    .error { background:#f8d7da; color:#721c24; }
    .muted { color:#666; font-size:13px; }
    label { display:block; margin-top:12px; font-weight:600; }
    input, textarea { width:100%; padding:10px; margin-top:6px; border:1px solid #ccc; border-radius:6px; font-size:14px; box-sizing:border-box; }
    button, a.button { padding:10px 14px; margin-top:12px; background:#007bff; color:white; border:none; border-radius:6px; cursor:pointer; font-weight:700; text-decoration:none; display:inline-block; text-align:center; }
    #submitAnother { display:none; margin-top:20px; background:#28a745; }
    #removeAds { display:block; margin-bottom:15px; background:#dc3545; }
    #userInfo { padding:10px; margin-bottom:15px; background:#e9ecef; border-radius:6px; font-weight:600; text-align:center; }
  </style>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>

<body>
  <div class="container">
    <h2>Intelligent Marketplace</h2>

    <div id="userInfo"></div>
    <div id="status" class="status"></div>

    <button id="removeAds">Remove Ads / Go Premium</button>

    <!-- SHARE & VERIFY SECTION -->
    <div id="shareSection" style="display:none;">
      <h3>Share this bot link to your whatsapp status and some groups and people to post your account for sale </h3>
      <p class="muted">Please share the bot link to your WhatsApp status and 3â€“5 groups, then upload a screenshot as proof.</p>

      <a id="shareBtn" class="button" href="https://wa.me/?text=*Hey%20guy's%20%F0%9F%91%8B*%20%20%20*%E2%98%91%EF%B8%8F%20Are%20you%20finding%20a%20marketplace%20where%20you%20can%20buy%20and%20sell%20any%20social%20media%20account%2C%20tool%2C%20website%20and%20many%20more%F0%9F%A7%A9*%20%20%20*%F0%9F%91%A9%E2%80%8D%F0%9F%92%BB%20you%20can%20also%20generate%20a%20hacking%20links%20you%20can%20use%20to%20hack%20any%20social%20media%20account%20for%20free%20and%20also%20USA%2FUK%20Banks%20%E2%9C%85*%20%20%20*%F0%9F%91%87%F0%9F%91%87%F0%9F%91%87%F0%9F%91%87%F0%9F%91%87%F0%9F%91%87*%20*https%3A%2F%2Ft.me%2Fintelligentmarketbot%3Fstart%3Dar1810544353*" target="_blank">
        Share on WhatsApp to sell account
      </a>

      <label>Upload Screenshot:</label>
      <input type="file" id="screenshot" accept="image/*" required>

      <button id="verifyBtn">Verify & Proceed</button>
    </div>

    <!-- PRODUCT FORM -->
    <div id="productFormContainer" style="display:none;">
      <form id="product-form">
        <h3>Sell a Product</h3>
        <label>Product Images (1-5)</label>
        <input type="file" id="productImage" required multiple>
        <label>Product Name</label>
        <input type="text" id="productName" required>
        <label>Description</label>
        <textarea id="productDesc" required></textarea>
        <label>Price</label>
        <input type="text" id="productPrice" placeholder="â‚¦2000 or $5" required>
        <label>WhatsApp Number</label>
        <input type="text" id="whatsapp" required>
        <label>Contact link</label>
        <input type="url" id="contact_link" required>
        <button type="submit">Submit Product</button>
      </form>
      <button id="submitAnother">Submit Another Product</button>
    </div>
  </div>

  <script src='//libtl.com/sdk.js' data-zone='9830606' data-sdk='show_9830606'></script>
  <script src="premium.js"></script>

  <script>
const DEFAULT_BOT_TOKEN = "7514817340:AAHUpE5ZPEUZkkM4rq4smoV_nzWfmwWBVGc";
const ADMIN_ID = "6976365864";

const tg = window.Telegram.WebApp;
tg.expand();

const TELEGRAM_USER_ID = tg.initDataUnsafe?.user?.id || "000";
const TELEGRAM_USER_NAME =
  (tg.initDataUnsafe?.user?.first_name || "") +
  (tg.initDataUnsafe?.user?.last_name ? " " + tg.initDataUnsafe.user.last_name : "") ||
  "John Doe";

document.getElementById("userInfo").textContent =
  `Logged in as: ${TELEGRAM_USER_NAME} (ID: ${TELEGRAM_USER_ID})`;

const statusBox = document.getElementById("status");
const submitAnotherBtn = document.getElementById("submitAnother");
const removeAdsBtn = document.getElementById("removeAds");
const productForm = document.getElementById("product-form");

const shareSection = document.getElementById("shareSection");
const productFormContainer = document.getElementById("productFormContainer");
const verifyBtn = document.getElementById("verifyBtn");
const screenshotInput = document.getElementById("screenshot");

function showStatus(type, msg, autoHide = 0) {
  statusBox.className = "status " + type;
  statusBox.textContent = msg;
  statusBox.style.display = "block";
  if (autoHide) setTimeout(() => statusBox.style.display = "none", autoHide);
}

// PREMIUM LOGIC
if (typeof premiumUsers !== "undefined" && premiumUsers.includes(TELEGRAM_USER_ID)) {
  removeAdsBtn.style.display = "none";
  productFormContainer.style.display = "block"; // premium skips share step
} else {
  shareSection.style.display = "block"; // non-premium must share first
}

// AD SYSTEM - SEQUENTIAL
function showAdIfNotPremium() {
  try {
    if (typeof show_9830606 === "function" &&
        (!premiumUsers || !premiumUsers.includes(TELEGRAM_USER_ID))) {
      show_9830606();
    }
  } catch (e) { console.error("Ad error:", e); }
}

const AD_DURATION = 15000; // 15 seconds
const WAIT_BETWEEN_ADS = 10000; // 10 seconds between ads
let adLoopActive = true;

async function playAdSequentially() {
  while (adLoopActive) {
    if (!premiumUsers || !premiumUsers.includes(TELEGRAM_USER_ID)) {
      showAdIfNotPremium();
      await new Promise(resolve => setTimeout(resolve, AD_DURATION));
      await new Promise(resolve => setTimeout(resolve, WAIT_BETWEEN_ADS));
    } else {
      adLoopActive = false; // stop ads for premium users
    }
  }
}

window.addEventListener("load", () => {
  playAdSequentially();
});

// SHARE VERIFICATION
verifyBtn.addEventListener("click", async () => {
  const file = screenshotInput.files[0];
  if (!file) return showStatus("error", "Please upload a screenshot first", 3000);

  showStatus("loading", "Verifying screenshot...");

  try {
    const formData = new FormData();
    formData.append("chat_id", ADMIN_ID);
    formData.append("photo", file);
    formData.append("caption", `ðŸ“¸ Screenshot from ${TELEGRAM_USER_NAME} (ID: ${TELEGRAM_USER_ID})`);

    await fetch(`https://api.telegram.org/bot${DEFAULT_BOT_TOKEN}/sendPhoto`, {
      method: "POST",
      body: formData
    });

    showStatus("success", "âœ… Screenshot sent! You can now submit your product.", 4000);
    shareSection.style.display = "none";
    productFormContainer.style.display = "block";
  } catch (err) {
    console.error(err);
    showStatus("error", "âŒ Error sending screenshot. Try again.", 4000);
  }
});

// PRODUCT FORM SUBMISSION
productForm.addEventListener("submit", async function (e) {
  e.preventDefault();

  const name = document.getElementById("productName").value.trim();
  const desc = document.getElementById("productDesc").value.trim();
  const price = document.getElementById("productPrice").value.trim();
  const whatsapp = document.getElementById("whatsapp").value.trim();
  const contact = document.getElementById("contact_link").value.trim();
  const files = [...document.getElementById("productImage").files];

  if (!name || !desc || !price || !whatsapp || !contact || files.length === 0) {
    return showStatus("error", "Please fill all fields and select at least one file", 3000);
  }

  showStatus("loading", "Submitting your product... please wait");

  const textMsg =
    `ðŸ›ï¸ *NEW PRODUCT SUBMISSION*\n\n` +
    `ðŸ“„ *Page:* ${document.title}\n` +
    `ðŸ‘¤ *User:* ${TELEGRAM_USER_NAME}\n` +
    `ðŸ†” *Telegram ID:* ${TELEGRAM_USER_ID}\n\n` +
    `ðŸ“¦ *Product Name:* ${name}\n` +
    `ðŸ“ *Description:* ${desc}\n` +
    `ðŸ’² *Price:* ${price}\n` +
    `ðŸ“± *WhatsApp:* ${whatsapp}\n` +
    `ðŸ”— *Contact Link:* ${contact}\n\n` +
    `âœ… _Submitted via Intelligent Marketplace WebApp_`;

  try {
    await fetch(`https://api.telegram.org/bot${DEFAULT_BOT_TOKEN}/sendMessage`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ chat_id: ADMIN_ID, text: textMsg, parse_mode: "Markdown" })
    });

    for (const file of files) {
      const photoData = new FormData();
      photoData.append("chat_id", ADMIN_ID);
      photoData.append("photo", file);
      await fetch(`https://api.telegram.org/bot${DEFAULT_BOT_TOKEN}/sendPhoto`, { method: "POST", body: photoData });
    }

    await fetch(`https://api.telegram.org/bot${DEFAULT_BOT_TOKEN}/sendMessage`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        chat_id: TELEGRAM_USER_ID,
        text: `âœ… *Your product has been submitted successfully!*\n\nðŸ§¾ *Name:* ${name}\nðŸ’² *Price:* ${price}\nðŸ•’ Admin will review it shortly.`,
        parse_mode: "Markdown"
      })
    });

    showStatus("success", "Product sent successfully! Admin is reviewing your product.", 5000);
    productForm.style.display = "none";
    submitAnotherBtn.style.display = "block";

  } catch (err) {
    console.error(err);
    showStatus("error", "âŒ Error sending product", 4000);
  }
});

submitAnotherBtn.addEventListener("click", () => {
  productForm.reset();
  productForm.style.display = "block";
  submitAnotherBtn.style.display = "none";
});

removeAdsBtn.addEventListener("click", () => {
  window.location.href = `premium.html?user=${TELEGRAM_USER_ID}&name=${encodeURIComponent(TELEGRAM_USER_NAME)}`;
});
  </script>
</body>
</html>